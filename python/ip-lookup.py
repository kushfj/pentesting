#!/bin/python

import requests
import sys

if len(sys.argv) != 3:
  print('Produces a comma separated list of the IP, and additional information')
  print('about the IP, e.g. country, state, city, postcode, and GPS location,')
  print('using the freegeoip.net web service.\n')
  print('usage:')
  print('  '+sys.argv[0]+' <input> <output>\n')
  print('where:')
  print('  input - is the input file with newline separated IPs')
  print('  output - is the file to append lookup results to\n')
  sys.exit('[-] error: invalid arguments')

o = open(sys.argv[2], 'a')

with open(sys.argv[1]) as f:
  for ip in f.readlines():
    u = 'http://freegeoip.net/csv/'+ip.strip()
    r = requests.get(u)
    if 200 == int(r.status_code):
      o.write((r.text).strip()+'\n')
    if 403 == int(r.status_code):
      sys.exit('[-] error: rate limited, try again in 60mins')

f.close()
o.flush()
o.close()
