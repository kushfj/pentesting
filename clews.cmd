@echo off
setlocal
cls
rem CLEWS - command line enumeration for windows systems
rem windows enumeration using standard command line tools
rem
rem This tools is modelled on the JAWS powershell script https://github.com/411Hall/JAWS
rem
rem versions
rem 0.1	-	initial version
rem
rem -- prep --
rem must accept eula first
rem accesschk.exe -accepteula 

set vers="0.1"
echo ================================================================================
echo =           Command Line based Enumeration for Windows Systems (CLEWS)         =
echo =                                                                              =
echo =                        https://github.com/kushfj/clews                       =
echo =                                                                              =
echo ================================================================================
echo [+] running: %*
echo [+] CLEWS version: %vers%


echo ================================================================================
echo [+] hostname
hostname
echo [+] date /t
date /t
echo [+] time /t
time /t
echo [+] whoami /all
whoami /all


echo ================================================================================
rem systeminfo
rem systeminfo | findstr /B /C:"OS Name" /C:"OS Version" 
echo [+] systeminfo
systeminfo
echo [+] driverquery
driverquery
echo [+] set
set


echo ================================================================================
rem users, groups, shares, and mapped drives
echo [+] query session
query session
echo [+] net accounts
net accounts
echo [+] net user
net user
echo [+] net localgroups
net localgroup
echo [+] net localgroups Administrators
net localgroup Administrators
echo [+] net localgroups "Remote Desktop Users"
net localgroup "Remote Desktop Users"
echo [+] net localgroups "Power Users"
net localgroup "Power Users"
echo [+] net localgroups Users
net localgroup
echo [+] net share
net share
echo [+] net use
net use
echo [+] gpresult /r
gpresult /r


echo ================================================================================
echo [+] for /f "tokens=1-2 delims=:" %%a in ('"netsh wlan show profiles | findstr "Profile ""') do ( if [%%b] neq [] netsh wlan show profiles name=%%b key=clear | findstr "SSID Cipher Content" | find /v "Number")
for /f "tokens=1-2 delims=:" %%a in ('"netsh wlan show profiles | findstr "Profile ""') do ( if [%%b] neq [] netsh wlan show profiles name=%%b key=clear | findstr "SSID Cipher Content" | find /v "Number")
echo [+] ipconfig /allcompartments /all
ipconfig /allcompartments /all
echo [+] ipconfig /displaydns
ipconfig /displaydns
echo [+] route print
route print
echo [+] arp -a
arp -a
echo [+] netstat -ano
netstat -ano
rem echo [+] netsh advfirewall dump
rem netsh advfirewall dump
echo [+] netsh advfirewall show allprofiles
netsh advfirewall show allprofiles


echo ================================================================================
rem schedules tasks 
echo [+] schtasks
schtasks


echo ================================================================================
rem services
rem sc sq ServiceName
rem accesschk -ucqv ServiceName
rem [-] fix this
rem echo [+] for /F "tokens=1,2" %%A in ('"sc query | findstr /i "SERVICE_NAME""') do (sc qc %%B & accesschk.exe -ucqv -nobanner %%B)
rem for /F "tokens=1,2" %%A in ('"sc query | findstr /i "SERVICE_NAME""') do (sc qc %%B & accesschk.exe -ucqv -nobanner %%B)
echo [+] for /F "tokens=1,2" %%A in ('"sc query | findstr /i "SERVICE_NAME""') do (sc qc %%B )
for /F "tokens=1,2" %%A in ('"sc query | findstr /i "SERVICE_NAME""') do (sc qc %%B )


echo ================================================================================
rem processes
echo [+] tasklist /v
tasklist /v


echo ================================================================================
rem installed programs
rem pslist -s
echo [+] for /f "tokens=1,2,*" %%i in ('"reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall" /s | findstr /B ".*DisplayName""') do (echo %%k)
for /f "tokens=1,2,*" %%i in ('"reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall" /s | findstr /B ".*DisplayName""') do (echo %%k)
echo [+] for /f "tokens=1,2,*" %%i in ('"reg query "HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall" /s | findstr /B ".*DisplayName""') do (echo %%k)
for /f "tokens=1,2,*" %%i in ('"reg query "HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall" /s | findstr /B ".*DisplayName""') do (echo %%k)
echo [+] dir "C:\Program Files\"
dir "C:\Program Files\"
echo [+] dir "C:\Program Files (x86)\"
dir "C:\Program Files (x86)\"


echo ================================================================================
rem all full access and modifiable files
rem icacls C:\ | findstr /i "(F) (M)" | findstr /i "%%USERNAME%% Everyone"
rem echo [+] dir c:\ /s /ad /a-r /b
rem dir C:\ /s /ad /a-r /b
echo [+] accesschk.exe -uwdqs Users C:\
accesschk.exe -uwdqs Users C:\
echo [+] accesschk.exe -uwqs Users C:\
accesschk.exe -uwqs Users C:\
echo [+] accesschk.exe -uwdqs "Authenticated Users" C:\
accesschk.exe -uwdqs "Authenticated Users" C:\
echo [+] accesschk.exe -uwqs "Authenticated Users" C:\
accesschk.exe -uwqs "Authenticated Users" C:\
echo [+] accesschk.exe -uwcqv "Authenticated Users" * 
accesschk.exe -uwcqv "Authenticated Users" * 


echo ================================================================================
rem attempt to find interesting user files
echo [+] for %%e in (.rdp .kdbx .pem .ppk .vnc .bat .ps1 .cmd) do (dir C:\Users /s /b | findstr %%e)
for %%e in (.rdp .kdbx .pem .ppk .vnc .bat .ps1 .cmd) do (dir C:\Users /s /b | findstr %%e)
echo [+] for %%e in ("unattended.xml", "sysprep.xml", "autounattended.xml","unattended.inf", "sysprep.inf", "autounattended.inf","unattended.txt", "sysprep.txt", "autounattended.txt") do (dir C:\ /s /b | findstr %%e)
for %%e in ("unattended.xml", "sysprep.xml", "autounattended.xml","unattended.inf", "sysprep.inf", "autounattended.inf","unattended.txt", "sysprep.txt", "autounattended.txt") do (dir C:\ /s /b | findstr %%e)


echo ================================================================================
rem check if all MSI always elevated for install
echo [+] reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
echo [+] reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated


echo ================================================================================
rem stored credentials
rem echo [+] dir /S /B *pass*.txt == *pass*.xml == *pass*.ini == *cred* == *vnc* == *.config*
rem dir /S /B *pass*.txt == *pass*.xml == *pass*.ini == *cred* == *vnc* == *.config*
rem echo [+] findstr /si password *.txt 
rem findstr /si password *.txt 
rem echo [+] findstr /si password *.xml
rem findstr /si password *.xml
rem echo [+] findstr /si password *.ini
rem findstr /si password *.ini
echo [+] findstr /si password *.txt *.xml *.ini
findstr /si password *.txt *.xml *.ini
echo [+] reg query HKLM /F "password" /t reg_sz /S /K
reg query HKLM /F "password" /t reg_sz /S /K
echo [+] reg query HKCU /F "password" /t reg_sz /S /K
reg query HKCU /F "password" /t reg_sz /S /K
echo [+] cmdkey /list
cmdkey /list



: end
endlocal
rem pause
